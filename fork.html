<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="js/jquery-1.7.1.min.js"></script>
<script src="js/webgl-utils.js"></script>
<script>
Fork = (function(undefined, window){
  var startLength_ = 128;
  var maxDepth_ = 12;

  var randInt = function(range) {
    return Math.floor(Math.random() * range);
  };

  var makeBranch = function(direction, length) {
    return {
      direction: direction,
      length: length,
    };
  };

  var addLeaves = function(branch, depth) {
    //console.log(depth + " " + maxDepth_);
    ++depth;
    if (depth > maxDepth_) {
      return;
    }

    var children = branch.children;
    if (children) {
      for (var ii = 0; ii < children.length; ++ii) {
        addLeaves(children[ii], depth);
      }
    } else {
      children = [];
      for (var ii = 0; ii < 2; ++ii) {
        var child = makeBranch(
            Math.PI / 1.5 * (ii ? 1 : -1),
            startLength_ / Math.pow(1.3, depth));
        children.push(child);
      }
      branch.children = children;
    }
  };

  var drawBranch = function(ctx, branch) {
    ctx.save();
    ctx.rotate(branch.direction);
    ctx.beginPath()
    ctx.moveTo(0, 0);
    ctx.lineTo(0, branch.length);
    ctx.stroke();
    var children = branch.children;
    if (children) {
      ctx.translate(0, branch.length);
      for (var ii = 0; ii < children.length; ++ii) {
        drawBranch(ctx, children[ii]);
      }
    }
    ctx.restore();
  };

  var drawTree = function(ctx, tree) {
    drawBranch(ctx, tree);
  };

  var makeTree = function(direction, length, maxDepth) {
    startLength_ = length;
    maxDepth_ = maxDepth || maxDepth_;
    return makeBranch(direction, length);
  };

  return {
    drawTree: drawTree,
    makeTree: makeTree,
    addLeaves: addLeaves,

    dummy: undefined,
  };
}());


function main() {
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext("2d");
  var triggerDraw;
  var tree = Fork.makeTree(0, 256);

  var draw = function() {
    Fork.addLeaves(tree, 0);

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "black";
    ctx.save();
    ctx.translate(canvas.width / 2, canvas.height / 2);
//    ctx.translate(canvas.width / 2, 0);

    Fork.drawTree(ctx, tree);

    ctx.restore();
  };

  var drawAndContinue = function() {
    draw();
    window.setTimeout(triggerDraw, 1000);
  };

  triggerDraw = function() {
    requestAnimFrame(drawAndContinue);
  }
  triggerDraw();
}

$(function(){
  main();
});

</script>
<style>
body {
    display: flex;
    flex-flow: row wrap;
    text-align: center;
  -webkit-box-pack: center;
  -webkit-box-align: center;
 }
</style>
</head>
<body>
<canvas id="canvas" width="1024" height="1024"></canvas>
</body>
</html>

