<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link type="text/css" href="js/css/doodle.css" rel="stylesheet" />
<link type="text/css" href="js/css/ui-lightness/jquery-ui-1.8.2.custom.css" rel="stylesheet" />
<script src="js/lzma.js"></script>
<script src="js/jquery-1.7.1.min.js"></script>
<script src="js/jquery-ui-1.8.2.custom.min.js"></script>
<script src="js/canvas-wrapper.js"></script>
<script src="js/webgl-utils.js"></script>
<script src="js/doodles.js"></script>
<script id="code" type="something-not-javascript">
var params = runCtx._.params;

var drawCircle = function(ctx, time, elapsedTime, anim, maxRadius, radius, maxDepth, depth) {
  ctx.save();
  if (anim) {
    var color = Doodles.makeColor(Doodles.colorRamp([
       [255, 0, 255],
       [255,255,0],
       [0,255,255],
       [255,0,255]
       ], depth / maxDepth));
    ctx.beginPath();
    ctx.arc(0, 0, radius, 0, Math.PI * 2, 1);

    if (params.solid) {
      ctx.fillStyle = Doodles.addAlphaToRGB(color, params.solid);
      ctx.fill();
    }

    if (params.thickness) {
      ctx.strokeStyle = color;
      ctx.stroke();
    }
  }
  if (depth < maxDepth) {
     var range = maxRadius * (1 - params.innerRadius)
     var lerp = 1 - Math.pow(1 - depth / maxDepth, params.power);
     var newRadius = maxRadius - range * lerp;
     ctx.rotate(time);
     ctx.translate(radius - newRadius, 0);
     drawCircle(ctx, time * params.timeMult + params.timeOffset, elapsedTime, anim, maxRadius, newRadius, maxDepth, depth + 1);
  }
  ctx.restore();
};

var draw = function(runCtx) {
  var ctx = runCtx.animCtx;
  var outerRadius = Math.min(ctx.canvas.width / 2, ctx.canvas.height / 2);
  var maxDepth = params.subDivisions;
  ctx.lineWidth = params.thickness;
  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
  ctx.save();
  ctx.translate(ctx.canvas.width / 2, ctx.canvas.height / 2);
  drawCircle(ctx, runCtx.time * params.speed, runCtx.elapsedTime, true, outerRadius, outerRadius, maxDepth, 0);
  ctx.restore();
};
draw(runCtx);
</script>
<script>
$(function(){
  var ui = [
    {name: 'subDivisions', value: 60,    min: 1,   max: 200, },
    {name: 'innerRadius',  value:  0.04, min: 0,   max:   1, },
    {name: 'power',        value:  2,    min: 0.1, max:   5, },
    {name: 'speed',        value:  0.1,  min: 0,   max:   4, },
    {name: 'timeMult',     value:  1,    min: 0,   max:   4, },
    {name: 'timeOffset',   value:  0,    min: 0,   max: Math.PI * 2, },
    {name: 'thickness',    value:  1,    min: 0,   max:  40, },
    {name: 'solid',        value:  0,    min: 0,   max:   1, },
  ];
  Doodles.init(ui);
});

</script>
</head>
<body>
</body>
</html>

