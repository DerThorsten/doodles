<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link type="text/css" href="js/css/doodle.css" rel="stylesheet" />
<link type="text/css" href="js/css/ui-lightness/jquery-ui-1.8.2.custom.css" rel="stylesheet" />
<script src="js/jquery-1.7.1.min.js"></script>
<script src="js/jquery-ui-1.8.2.custom.min.js"></script>
<script src="js/canvas-wrapper.js"></script>
<script src="js/webgl-utils.js"></script>
<script src="js/doodles.js"></script>
<script id="code" type="something-not-javascript">
var params = runCtx._.params;

var drawInnerCircle = function(ctx, time, outerRadius, innerRadius, anim) {
  ctx.rotate(time);
  ctx.translate(outerRadius - innerRadius, 0);
  if (anim) {
    ctx.beginPath();
    ctx.arc(0, 0, innerRadius, 0, Math.PI * 2, 0);
    ctx.stroke();
  }

  ctx.rotate(-time * (params.numLoops + (params.numSubLoops ? 1 / params.numSubLoops : 0)));
  if (anim) {
    ctx.beginPath();
    ctx.moveTo(innerRadius, 0);
  }
  ctx.translate(innerRadius * params.innerRadius, 0);
  if (anim) {
    ctx.lineTo(0, 0);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(0, 0, 5, 0, Math.PI * 2, 0);
    ctx.fill();
  } else {
    var t = ctx.getTransform();
    runCtx._.newX = t[4];
    runCtx._.newY = t[5];
  }
  ctx.restore();
};

var drawOuterCircle = function(ctx, time, elapsedTime, anim) {
  ctx.save();
  if (anim) {
    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
  }
  ctx.translate(ctx.canvas.width / 2, ctx.canvas.height / 2);
  var outerRadius = Math.min(ctx.canvas.width / 2, ctx.canvas.height / 2);
  if (anim) {
    ctx.strokeStyle = "red";
    ctx.fillStyle = "blue";
    ctx.beginPath();
    ctx.arc(0, 0, outerRadius, 0, Math.PI * 2, 1);
    ctx.stroke();
  }
  drawInnerCircle(ctx, time, outerRadius, outerRadius * params.radius, anim);
  ctx.restore();
};

var draw = function(ctx) {
  drawOuterCircle(ctx.animCtx, ctx.time, ctx.elapsedTime, true);
  drawOuterCircle(ctx.drawCtx, ctx.time, ctx.elapsedTime, false);

  if (ctx.time > ctx._.oldTime) {
    ctx.drawCtx.beginPath();
    ctx.drawCtx.moveTo(ctx._.lastX, ctx._.lastY);
    ctx.drawCtx.lineTo(ctx._.newX,  ctx._.newY);
    ctx.drawCtx.strokeStyle = "black";
    ctx.drawCtx.lineWidth = 0.5;
    ctx.drawCtx.stroke();
  }
  ctx._.oldTime = ctx.time;
  ctx._.lastX = ctx._.newX;
  ctx._.lastY = ctx._.newY;
};

draw(runCtx);
</script>
<script>
$(function(){
  var ctx;
  var fn = function() {
    if (ctx) {
      Doodles.resetCanvases(ctx);
    }
  };
  var ui = [
    {name: 'radius',       value:  0.66, min: 0, max: 1, },
    {name: 'innerRadius',  value:  0.33, min: 0, max: 1, },
    {name: 'numLoops',     value:  3, min: 0, max: 100, type: 'int'},
    {name: 'numSubLoops',  value:  20, min: 0, max: 100, type: 'int'},
  ];
  ctx = Doodles.init(ui, fn);
});

</script>
</head>
<body>
<div id="content">
  <table>
    <tr>
      <td>
        <textarea id="editor"></textarea>
      </td>
      <td>
        <div id="canvasContainer">
          <canvas id="drawCanvas"></canvas>
          <canvas id="animCanvas"></canvas>
        </div>
      </td>
  </table>
</div>
<div id="uiContainer">
  <div id="ui"></div>
</div>
</body>
</html>

